// 仕様書
// 左右キーで移動
// Qキーでショット変更、Zキーで発射。
// 2で割る、3で割る、1を足す、の3通りの攻撃ができる
// 2と3で割る攻撃は割り切れないと弾かれ、2の場合は数が3倍になり、3の場合は数が2倍になる。
// 1を足すことでしか倒せない敵が現れる（7とか11とか）
// しかも2や3で楽に倒せる敵と一緒に現れるのでやっかい
// 下の陣地に到達されたらゲームオーバー。以上。
// 上の方からシャボン玉みたいなのがふわーっと降りてきて
// 数フレームごとに方向転換しつつ降りてきて
// 陣地に到達したらOUT!?

// 面倒だから本体と敵の当たり判定は無しで。陣地に到達したらってことで。

// 最終的には2か3のときに攻撃を当てて1にすれば倒せるので、そうなったらinActiveにしてエフェクトを発生させて、
// 以降はエフェクトが消えるのを待つばかりみたいにする。本体はもう死んでる。
// スコアシステムは後回しでいいんじゃない・・外したら減点とか、手数が少ないと高得点とか？

// 下部の480x40の部分を黒塗りにして、白文字で/2, /3, +1と書かれてるのをやって・・Qキーで移るようにするとか。
// 合ってる時は白地に黒文字で/2, /3, +1になる感じ。

// ギミックが発生してすべての数に35がプラスされるとか
// すべての数が5倍されるとか、7倍されるとか。あったら面白いね。いわゆるサドンデス？
// 敵が攻撃してくる、当たってもやられないけどしばらくショットが撃てなくなるみたいな。

// アイテム効果1: waitの減り方が2倍になる。
// アイテム効果2: 相手の数字をそれ以上のもののうち最小の2と3のベキの積にする

// プログラムというクラスを作りたいけど先にエフェクトかな・・

// 3桁倒せません。スピード落としてください。お願いします。

// 簡単なものとしては倒すたびに次、次、みたいな。うん。

// 今日の仕様変更
// ダウンの距離を半分にしたい。効果時間は同じでいい。
// 色とスコアは不変にする。数が変わった場合の処理はスピードだけ変更する。
// uniqueIdを用意する。で、numは可変。numが変わるたびにfactorIdを変えて文字表示とかに使う。
// 桁数が大きい程遅く、小さい程速く。そして角度は下方PI/8で固定しましょう。PI/8または7*PI/8くらい。
// cosとsinの値を定数にしておく。
// 1桁で6から始まって5.5, 5, 4.5, 4, 3.5, 3って感じ。最遅で3.
// 桁数については6桁、7桁の仕様を用意する。8桁以上になった場合はゲームオーバーにする。
// 8桁以上になった場合はゲームオーバーにする。（大事な事なので2回言った）
// うん、+1では動かないようにしよう。で、/2のとき10, /3のとき40ズレるようにする。効果時間は20, 40にしよう。
// スコアシステム。
// まず基礎点が、1, 2, 3, 4, 5, 6, 7桁について200, 500, 2000, 5000, 10000, 30000, 50000にする。
// そのうえで、+1ショットを当てるごとに50点、/2ショットを当てるごとに100点、/3ショットを当てるごとに300点入る。
// それ以外に連鎖ボーナスと連鎖ペナルティを用意する。
// 連鎖ボーナス：/2または/3がヒットするたびに増えていく。最初は各々x1またはx3で、それ以降は/2をヒットさせるとひとつ、
// /3をヒットさせると3つ増える。たとえば/2/2/3/3/2だとx1, x2, x5, x8, x9と増えていく。
// +1をヒットさせるか、/2, /3でミスするか、ショットを外すと連鎖が切れる。
// 外すというのは、ブリンク中に当ててしまった場合も含む。だからブリンク処理も作ってね・・。
// 連鎖中に敵を倒すとそのときのxNのNが基礎点に掛けられてスコア合計となる。
// 倒しても連鎖は続く。連鎖が途切れる条件を満たさない限りずっと続く。
// 同じ敵でなくても/2や/3がヒットし続ける限り連鎖は続く。
// つまり、ノー連鎖で普通に/2や/3を当てて倒しても基礎点そのものしかもらえないけど、
// /2/2で倒せば2倍だし、/2/3で倒せば4倍になる。(/3/3だと6倍。)
// 連鎖ペナルティ：/2や/3を外した場合、1回目は普通に-100だけど、
// 続けてこれをやると-200, -400, -800と倍になっていく。数を大きくして楽に連鎖させないための処理。
// また、基礎点は変わらないので小さい数の敵の数を大きくしたところで高い点が入るわけではなく全く無意味だよとそういう意味もある。
// 連鎖は+1, /2, /3のいずれかをきちんとヒットさせると止まる。ちなみに外しても連鎖は止まらない。
// わざと外して連鎖を切られないための処理。
// ここまで実装したいです。とりあえずブリンクとかその辺。
// 連鎖ボーナスは白地に赤文字で中央下のスペースに表示。
// スコアは7桁くらいで（カンスト9999999）右下のスペースに表示。
// ペナルティは100, 200, 300, ...でいいかな・・1000がMAXで。
// ボーナスは、最初だけx1にして、それ以降は/2なら+2, /3なら+4の方が面白そう。
// それでもちょっと小さいな・・当てるのほんと大変だし。

// ペナルティは100, 200, 300, 400って増える（連続して当てるのも大変）
// ボーナスは連続して当てる・・

// スコアより先に敵が現れるシステム作りたい
// 真ん中、1桁（2～9）、120フレームおきに1匹ずつ。とりあえずそれで。
// 連鎖の概要
// hitChainとmissChainというふたつの変数を用意してそれぞれスコア計算の時に使う感じ。
// 共にデフォルトは0とする。

// shotのフラグについて
// 0:デフォルト、chain計算ではスルーされる。---何もなし
// 1:/2がきちんとヒット------------------------hitChain+=1, missChain=0. スコア+100
// 2:/3がきちんとヒット------------------------hitChain+=3, missChain=0. スコア+300
// 3:+1がきちんとヒット------------------------hitChain=0, missChain=0.  スコア+50
// 4:弾かれた----------------------------------hitChain=0, missChain+=1. スコア-100 * missChain フラグを0にする
// 5:相手がブリンク、又は画面上方に消えた------hitChain=0, missChain変化なし
// 画面下方にに消えた場合はない。弾かれたときにフラグをオフにしているので。そのあとは衝突判定しないし。
// chainの計算をした後、敵が倒れたかどうかの判定をする。
// 倒れた場合に基礎スコア×hitChainだけスコアが増える。

// hitで受け取るflagをその数にするか・・今trueとかfalseとかなってるところをいじろう。

// 直径を10から15にして当てやすくした。
// ボムで全体攻撃とか面白そう。
// /2ボムは/2をヒットさせるとそこを中心に円形に当たり判定が広がって範囲内の
// 2で割れる全ての敵を/2する（/2出来ない場合はスルー）。で、shotChainもそのまま加算される。
// /3ボムも同様。
// 長押しでゲージがたまって出るようにする。（3秒くらい）
// あるいはショットを当てるたびにゲージがたまっていってボムを使うと戻る、でもいいかも
// その前にステージ作れや

// 一定範囲に一定フレームごとに一定の範囲の数を1匹ずつ
// 複数の場所に固定された数の敵を同時に出現させる
// 時間をおいて出現させる
// 複数の場所に一定範囲の敵を同時に出現させるのを一定フレームごとに
// 同じ範囲の数の敵を複数の場所に・・
// いろいろバリエーション書いて統一的に記述できるように工夫しましょう。

// 上からボムが降ってくる
// ボムは回転する四角形で当たり判定は円でOK.
// 攻撃を当てると敵と同じ反応を示す。/2と/3を当てるたびに、当てた回数が、
// 合計が5以下の時は多い方か、最後に当てた攻撃の色になり、6以上では同じ回数だと（最低でも3, 3ということ）
// 特殊な色になる。/2の方が多い時は全体で/2効果、/3の方が多い時は全体/3効果、同じ場合は一定時間動きを止める（5秒くらい）
// とかそういう感じのアイテムが手に入り一度に1つまでしか持てない。動き方は敵と同じ感じでOK.
// ・・・という、戯言。
// マウス操作で出来るようにしたい。
// マウスが自機の右にある時右に毎フレーム+5移動、逆も然り。
// マウスが自機のxの±20くらいの時は動かないようにする。（foolProofみたいな）
// 自機をクリックすることでショット変更できるようにする。そんな感じの。
// どちらか選べるようにしたい・・
// そろそろタイトル画面欲しいかも

// とりあえずジェネレータ。
// simpleMono: 一定間隔で一定回数、ある範囲（指定かランダム）にある数（指定かランダム）を配置する。
// simpleMulti: 一定間隔で一定回数、複数の範囲（指定かランダム）にある数（指定かランダム）を配置する。
// で、これらを組み合わせていく感じ。たとえばボスだけ用意してあとエンドレスとか。

// intervalの考え方についてはもともと再考の余地があったからどうでもいい
// それを管理するクラスがあればいいんでしょ
// それとパターンを分ければいいんじゃない
// たとえば2を0, 60, 60, 60で実行するとか。timerみたいな。

// GAMEOVERとSTARTとCLEARからのNEXT STAGEとかそういうの
// いつものようにSTARTさせる、updateしないでrenderだけ。
// 残機数を用意
// 残機があるときはfailedにしてそのステージの最初から・・スコア-2000のペナルティ。
// 残機0になったらGAMEOVERで最初からやり直し。
// 一通りクリアした時に残機数x10000のボーナスが入る感じ。んー。10くらいを想定。
// 全クリアした時もスコアをリセットするから大変。
// ステージオールクリアでスコアを同時に表示(ボーナス加算済み)。

// 現状やるべきこと

// 1. エフェクトをまとめる（敵の攻撃を作るための前段階）
// エフェクト、numberFloatとやられるやつを一緒にしたい。やってること一緒だし。
// それで、classとしては初期位置だけ共通、やられる場合は画像と色を送る、というかインデックスでいい？んー。
// 数字の方は数字を送る感じ。正とか負とか。

// 2. スコア修正
// スコアについて若干修正。
// 敵のスコアをMath.sqrt(「持っている数」)×50にする。たとえば3なら50点、16で200点、1000000で50000点、MAXで150000くらい。
// そのうえで、弾かれた場合の減少スコアを持ちスコア×0.2×チェイン数にする。
// その前段階として、とりあえずcalcChainの返り値としてスコアの増減を計算するのをやめたい。
// あそこはreturnにして、・・結局敵の情報とかも要るので。

// あー、そうか、ここでショット関連のスコア計算するのおかしいんだ。
// ショット関連だからなー・・衝突判定で書かないと。で、敵倒したときのスコアは、
// 敵がやられるからさ、removeに書くんだけど、ショット関連は衝突判定・・今、敵を走査してからショットを走査
// してるから、逆にして、そっちに、書けよー。

// 「衝突判定にスコア計算を移す処理の概要」
// ショットを走査してショットごとにenemyを走査。終わったらショット関連のスコア計算。
// というか、弾かれたらbreakしちゃう。で、計算に入る。
// ていうか敵のスコアを記録するんだっけ・・だったらもういっそスコアはこっちで計算しちゃうか。その方がいい。
// メソッドはなるべく分ける方向で。ごちゃごちゃすると分かりにくくなる。

// 3. ブリンク実装
// 画像が点滅してダメージを受けた直後の無敵状態を表現するのやりたい。
// 攻撃時には体が円形の膜で覆われて無敵になるとかそういうの想定してる。

// 攻撃案
// 0: 一定時間バリアを張る（3秒くらい）。つまりデフォルト、動きはその間止まる。特にすることはない。
// 1: 弾を発射して、当たると5秒間/3ショットが出せなくなる。地の色を赤にして文字は白。
// 発射の際に1秒間無敵になる。弾道：遅い直線
// 2: 弾を発射して、当たると5秒間/2ショットが出せなくなる。地の色を赤にして文字は白。
// 発射の際に1秒間無敵になる。弾道：揺れながら直進、やや速い
// 3: 自分の数を5倍する。場合によってはそのままゲームオーバー（実質即死）。
// 発動の際に1秒間無敵になる。弾道：速い直線
// 4: 弾を発射して、当たると5秒間+1ショットが出せなくなる。地の色を赤にして文字は白。
// 発射の際に1.5秒間無敵になる。
// 5: 弾を発射して、当たると3秒間動けなくなる。
// 発射の際に2.0秒間無敵になる。弾道：小さい弾の3WAY
// 6: 自分の数字を5秒間見えなくさせる（？？？と表示される）。
// 発動の際に1秒間無敵になる。
// 以上。
// 無敵表現でエフェクトの継承クラスを使いたい。

// 当たらなくてウザい
// ホーミング性能作ろう。小、中、大くらい。一番近くの敵が右にいるか左にいるかを見て（x座標）
// そっちの方向に曲がるの。当たりやすくなると思う。
// 敵に攻撃させるんだったらそのくらいないとね。
// ランダムモードは3桁～7桁まで用意する感じ。
// ステージクリアは7つのステージを用意する感じ
// チャレンジモードはすごいむずいのを用意・・する？？
